import streamlit as st
import os

# --- 1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡∏ä‡∏≤ (Database) ---
all_courses_db = {
    "RAM1101": [3, "4", "A", "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢", "RAM"], "RAM1111": [3, "4", "B", "‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© 1", "RAM"],
    "RAM1112": [3, "3", "B", "‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© 2", "RAM"], "RAM1132": [3, "3", "A", "‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î", "RAM"],
    "RAM1141": [3, "2", "A", "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å‡∏†‡∏≤‡∏û", "RAM"], "RAM1204": [3, "3", "B", "‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î", "RAM"],
    "RAM1213": [3, "3", "A", "‡∏ß‡∏¥‡∏ä‡∏≤ RAM", "RAM"], "RAM1301": [3, "4", "B", "‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏°", "RAM"],
    "RAM1303": [3, "2", "B", "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", "RAM"], "RAM1312": [3, "4", "B", "‡∏ß‡∏¥‡∏ä‡∏≤ RAM", "RAM"],
    "LAW1101": [2, "2", "A", "‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡∏°‡∏´‡∏≤‡∏ä‡∏ô", "LAW"], "LAW1102": [2, "4", "A", "‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏≠‡∏Å‡∏ä‡∏ô", "LAW"],
    "LAW1103": [3, "2", "A", "‡∏ô‡∏¥‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°", "LAW"], "LAW2101": [3, "2", "B", "‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå", "LAW"],
    "LAW2102": [3, "3", "A", "‡∏´‡∏ô‡∏µ‡πâ", "LAW"], "LAW2104": [3, "2", "B", "‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç", "LAW"],
    "LAW2105": [3, "4", "A", "‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢", "LAW"], "LAW2106": [3, "4", "A", "‡∏≠‡∏≤‡∏ç‡∏≤ 1", "LAW"],
    "LAW2107": [3, "1", "B", "‡∏≠‡∏≤‡∏ç‡∏≤ 2", "LAW"], "LAW2109": [3, "3", "B", "‡∏¢‡∏∑‡∏° ‡∏ù‡∏≤‡∏Å", "LAW"],
    "LAW2110": [2, "1", "B", "‡∏Ñ‡πâ‡∏≥ ‡∏à‡∏≥‡∏ô‡∏≥", "LAW"], "LAW2111": [2, "3", "A", "‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô", "LAW"],
    "LAW2112": [2, "4", "B", "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô", "LAW"], "LAW2113": [3, "2", "A", "‡∏ï‡∏±‡πã‡∏ß‡πÄ‡∏á‡∏¥‡∏ô", "LAW"],
    "LAW2108": [2, "1", "A", "‡πÄ‡∏ä‡πà‡∏≤ ‡∏à‡πâ‡∏≤‡∏á", "LAW"], "LAW3101": [2, "1", "A", "‡∏≠‡∏≤‡∏ç‡∏≤ 3", "LAW"],
    "LAW3102": [3, "4", "B", "‡∏´‡∏∏‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô", "LAW"], "LAW3103": [3, "1", "B", "‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß", "LAW"],
    "LAW3104": [2, "3", "A", "‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç‡∏®‡∏≤‡∏•", "LAW"], "LAW3105": [3, "1", "B", "‡∏ß‡∏¥.‡πÅ‡∏û‡πà‡∏á 1", "LAW"],
    "LAW3106": [3, "4", "B", "‡∏ß‡∏¥‡∏≠‡∏≤‡∏ç‡∏≤ 1", "LAW"], "LAW3109": [3, "3", "B", "‡∏°‡∏£‡∏î‡∏Å", "LAW"],
    "LAW3110": [2, "1", "A", "‡∏•‡πâ‡∏°‡∏•‡∏∞‡∏•‡∏≤‡∏¢", "LAW"], "LAW3111": [3, "2", "A", "‡∏û‡∏¢‡∏≤‡∏ô", "LAW"],
    "LAW3112": [3, "1", "B", "‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á", "LAW"], "LAW3117": [2, "1", "A", "‡∏õ.‡∏ß‡∏¥‡∏°‡∏´‡∏≤‡∏ä‡∏ô", "LAW"],
    "LAW4101": [2, "1", "A", "‡∏†‡∏≤‡∏©‡∏µ", "LAW"], "LAW4102": [3, "2", "B", "‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°", "LAW"],
    "LAW4103": [3, "4", "A", "‡∏Ñ‡∏î‡∏µ‡πÄ‡∏°‡∏∑‡∏≠‡∏á", "LAW"], "LAW4104": [2, "2", "B", "‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô", "LAW"],
    "LAW4105": [2, "2", "A", "‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û‡∏ó‡∏ô‡∏≤‡∏¢", "LAW"], "LAW4106": [2, "3", "A", "‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡∏ä‡∏ô", "LAW"],
    "LAW4107": [2, "2", "B", "‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡∏≤", "LAW"], "LAW4108": [3, "2", "B", "‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô", "LAW"],
    "LAW4109": [3, "4", "A", "‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏õ‡∏±‡∏ç‡∏ç‡∏≤", "LAW"], "LAW4110": [2, "1", "A", "‡∏Ñ‡πâ‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®", "LAW"],
    "LAW3133": [3, "3", "B", "‡∏≠‡∏≤‡∏ä‡∏ç‡∏≤‡∏Å‡∏£", "ELECTIVE"], "LAW3138": [2, "1", "B", "‡πÄ‡∏î‡πá‡∏Å", "ELECTIVE"],
    "LAW4134": [2, "1", "B", "‡∏ó‡∏∞‡πÄ‡∏•", "ELECTIVE"], "LAW4156": [2, "2", "A", "‡∏≠‡∏¥‡πâ‡∏á‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢", "ELECTIVE"],
    "‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1": [3, "0", "0", "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏£‡∏µ 1", "ELECTIVE"], "‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 2": [3, "0", "0", "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏£‡∏µ 2", "ELECTIVE"]
}

exam_slots = ["-", "1A", "1B", "2A", "2B", "3A", "3B", "4A", "4B"]

st.set_page_config(page_title="Law Slot Planner", layout="wide")

# --- CSS: ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ---
st.markdown("""
    <style>
    header {visibility: hidden;}
    .slot-card {
        background-color: #ffffff;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 10px;
    }
    .stSelectbox label { font-size: 12px !important; color: #666; }
    .header-text { font-weight: bold; font-size: 18px; color: #2c3e50; text-align: center; }
    </style>
    """, unsafe_allow_html=True)

st.title("‚öñÔ∏è Law Registration Slot Planner")

# ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏à‡∏±‡∏î (‡∏Ñ‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πâ‡πÅ‡∏ö‡πà‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå)
col_y, col_t, col_g = st.columns([1, 1, 1])
selected_year = col_y.selectbox("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤", [1, 2, 3, 4])
selected_term = col_t.selectbox("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ó‡∏≠‡∏°", ["1", "2", "S"])
is_grad = col_g.toggle("üéì ‡∏Ç‡∏≠‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏™‡∏≠‡∏ö‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô‡πÑ‡∏î‡πâ)")

st.divider()

st.markdown(f"<p class='header-text'>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡πÅ‡∏ú‡∏ô: ‡∏õ‡∏µ {selected_year} ‡πÄ‡∏ó‡∏≠‡∏° {selected_term}</p>", unsafe_allow_html=True)

# ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏•‡πá‡∏≠‡∏ï 8 ‡πÅ‡∏ñ‡∏ß
current_term_key = f"Y{selected_year}T{selected_term}"
total_credits = 0
exam_conflicts = []
used_exams = {}

# ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Dropdown
course_options = ["-"] + sorted(list(all_courses_db.keys()))

cols = st.columns(4) # ‡πÅ‡∏ö‡πà‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• 4 ‡∏™‡∏•‡πá‡∏≠‡∏ï‡∏ï‡πà‡∏≠‡πÅ‡∏ñ‡∏ß (‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô 2 ‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏á‡πà‡∏≤‡∏¢)

for i in range(1, 9):
    # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏•‡πá‡∏≠‡∏ï
    with cols[(i-1) % 4]:
        st.markdown(f"**‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà {i}**")
        
        # 1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤
        selected_code = st.selectbox(f"‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤", course_options, key=f"sub_{current_term_key}_{i}")
        
        if selected_code != "-":
            info = all_courses_db[selected_code]
            total_credits += info[0]
            
            # 2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏™‡∏≠‡∏ö (Default ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å DB)
            default_exam = f"{info[1]}{info[2]}" if info[1] != "0" else "-"
            idx = exam_slots.index(default_exam) if default_exam in exam_slots else 0
            
            exam_time = st.selectbox(f"‡∏ß‡∏±‡∏ô‡∏™‡∏≠‡∏ö", exam_slots, index=idx, key=f"exam_{current_term_key}_{i}")
            
            # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏≠‡∏ö‡∏ä‡∏ô
            if exam_time != "-":
                if exam_time in used_exams:
                    exam_conflicts.append(f"{selected_code} ‡∏ä‡∏ô‡∏Å‡∏±‡∏ö {used_exams[exam_time]} ({exam_time})")
                used_exams[exam_time] = selected_code
            
            st.caption(f"{info[3]} ({info[0]} ‡∏ô‡∏Å.)")
        else:
            st.selectbox(f"‡∏ß‡∏±‡∏ô‡∏™‡∏≠‡∏ö", ["-"], key=f"exam_empty_{i}", disabled=True)

# --- ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÄ‡∏ó‡∏≠‡∏°‡∏ô‡∏µ‡πâ ---
st.divider()
c1, c2 = st.columns(2)

with c1:
    max_c = 30 if is_grad else (9 if selected_term == "S" else 22)
    st.metric("‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡∏£‡∏ß‡∏°‡πÄ‡∏ó‡∏≠‡∏°‡∏ô‡∏µ‡πâ", f"{total_credits} / {max_c}")
    if total_credits > max_c:
        st.error(f"‚ùå ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡πÄ‡∏Å‡∏¥‡∏ô {max_c}!")

with c2:
    if exam_conflicts:
        if is_grad:
            st.warning("‚ö†Ô∏è ‡∏°‡∏µ‡∏ß‡∏¥‡∏ä‡∏≤‡∏™‡∏≠‡∏ö‡∏ä‡∏ô‡∏Å‡∏±‡∏ô (‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏≠‡∏ö‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô)")
            for c in exam_conflicts: st.write(f"- {c}")
        else:
            st.error("‚ùå ‡∏™‡∏≠‡∏ö‡∏ä‡∏ô‡∏Å‡∏±‡∏ô! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤")
            for c in exam_conflicts: st.write(f"- {c}")
    elif total_credits > 0:
        st.success("‚úÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≠‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ")

# --- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏£‡∏¥‡∏°) ---
with st.expander("üìä ‡∏î‡∏π‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß"):
    st.write("‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏à‡∏≥‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏ó‡∏≠‡∏° (‡∏ï‡∏£‡∏≤‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà Refresh ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö)")
